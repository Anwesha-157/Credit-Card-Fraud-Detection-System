<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fraud Detection Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="title-heading">ğŸ•µï¸ Credit Card Fraud Detection Dashboard</h2>
      <a href="/logout" class="btn btn-danger">Logout</a>
    </div>

    <!-- Upload Section -->
    <div class="card mb-4">
      <div class="card-header">ğŸ“¤ Step 1: Upload Transaction File</div>
      <div class="card-body">
        <form id="upload-form" method="POST" enctype="multipart/form-data" action="/upload">
          <label for="file" class="form-label">Upload CSV File</label>
          <input class="form-control mb-3" type="file" id="file" name="file" accept=".csv" required>
          <button type="submit" class="btn btn-primary">Detect Fraud</button>
        </form>
        <div id="loading" class="mt-3" style="display: none;">
          <div class="alert alert-info">Processing your data... please wait.</div>
        </div>
      </div>
    </div>

    {% if raw_preview %}
    <!-- Raw Data Preview -->
    <div class="card mb-4">
      <div class="card-header">ğŸ“„ Step 2: Raw Data Preview</div>
      <div class="card-body">
        {{ raw_preview | safe }}
      </div>
    </div>
    {% endif %}

    {% if preprocessing_summary %}
    <!-- Preprocessing Summary -->
    <div class="card mb-4">
      <div class="card-header">ğŸ§¹ Step 3: Preprocessing Summary</div>
      <div class="card-body">
        <pre>{{ preprocessing_summary }}</pre>
      </div>
    </div>
    {% endif %}

    {% if eda_summary %}
    <!-- EDA Summary -->
    <div class="card mb-4">
      <div class="card-header">ğŸ“Š Step 4: Exploratory Data Analysis (EDA)</div>
      <div class="card-body">
        <pre>{{ eda_summary }}</pre>
        {% if eda_plot %}
          <img src="{{ url_for('static', filename='eda_plot.png') }}" class="img-fluid mt-3 mb-3" alt="EDA Histogram">
        {% endif %}
        {% if fraud_plot %}
          <img src="{{ url_for('static', filename='fraud_agencies.png') }}" class="img-fluid mt-3" alt="Top Fraud Agencies">
        {% endif %}
      </div>
    </div>
    {% endif %}

    {% if table %}
    <!-- Fraud Detection Results -->
    <div class="card mb-4">
      <div class="card-header">ğŸš¨ Step 5: Detected Fraudulent Transactions</div>
      <div class="card-body">
        <p><strong>Total Transactions:</strong> {{ total_transactions }}</p>
        <p><strong>Fraudulent Transactions Detected:</strong> {{ fraud_count }}</p>
        <p><strong>Fraud Percentage:</strong> {{ fraud_percentage }}%</p>

        <div class="table-responsive">
          {{ table | safe }}
        </div>
        <a href="/download" class="btn btn-success mt-3">Download Fraud Report</a>
      </div>
    </div>
    {% endif %}
  </div>

  <footer class="footer-text text-center mt-5">Â© 2025 M.Tech Mini Project â€“ Credit Card Fraud Detection</footer>

  <script>
    const form = document.getElementById('upload-form');
    const loading = document.getElementById('loading');
    form.addEventListener('submit', () => {
      loading.style.display = 'block';
    });
  </script>
</body>
</html>
